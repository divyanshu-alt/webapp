<!DOCTYPE html>
<html>
<head>
    <title>Game Lobby</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }
        #players { background: #f0f0f0; padding: 15px; }
        #chat { display: flex; flex-direction: column; height: 400px; }
        #messages { flex: 1; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .message { margin-bottom: 8px; }
        .system-message { color: #666; font-style: italic; }
        input, button { padding: 8px; margin-bottom: 10px; }
        button { cursor: pointer; background: #007bff; color: white; border: none; }
    </style>
</head>
<body>
    <div id="lobby-creation">
        <h1>Create or Join Lobby</h1>
        <input type="text" id="username" placeholder="Enter your name" required>
        <input type="text" id="lobby-code" placeholder="Enter lobby code (leave blank to create new)">
        <button onclick="handleJoin()">Join</button>
        <div id="error" style="color: red;"></div>
    </div>

    <div id="lobby-interface" style="display: none;">
        <h2>Lobby Code: <span id="lobby-code-display"></span></h2>
        <div class="container">
            <div id="players">
                <h3>Players (<span id="player-count">0</span>)</h3>
                <ul id="player-list"></ul>
            </div>
            <div id="chat">
                <div id="messages"></div>
                <input type="text" id="message-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send Message</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentLobbyCode = '';

        function handleJoin() {
            const username = document.getElementById('username').value.trim();
            const code = document.getElementById('lobby-code').value.trim().toLowerCase();
            
            if (!username) {
                showError('Please enter a username');
                return;
            }

            if (code) {
                socket.emit('join-lobby', { code, username });
            } else {
                socket.emit('create-lobby', username);
            }
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (message) {
                socket.emit('chat-message', message);
                input.value = '';
            }
        }

        // Socket event handlers
        socket.on('lobby-created', (code) => {
            currentLobbyCode = code;
            showLobbyInterface(code);
        });

        socket.on('lobby-joined', () => {
            showLobbyInterface(document.getElementById('lobby-code').value.toUpperCase());
        });

        socket.on('player-list', (players) => {
            const list = document.getElementById('player-list');
            list.innerHTML = players.map(p => `<li>${p}</li>`).join('');
            document.getElementById('player-count').textContent = players.length;
        });

        socket.on('chat-message', ({ username, message }) => {
            addMessage(`${username}: ${message}`);
        });

        socket.on('player-left', ({ username, reason }) => {
            addMessage(`System: ${username} left (${reason})`, true);
        });

        socket.on('lobby-disbanded', () => {
            alert('Lobby has expired');
            window.location.reload();
        });

        socket.on('error', (message) => {
            showError(message);
        });
        
        // Shows as "Happy-Penguin" but stores as "happy-penguin"
        function displayLobbyCode(code) {
          return code.split('-').map(word =>
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join('-');
        }

        function showLobbyInterface(code) {
            document.getElementById('lobby-creation').style.display = 'none';
            document.getElementById('lobby-interface').style.display = 'block';
            document.getElementById('lobby-code-display').textContent = displayLobbyCode(code);
        }

        function addMessage(message, isSystem = false) {
            const div = document.createElement('div');
            div.className = `message ${isSystem ? 'system-message' : ''}`;
            div.textContent = message;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            setTimeout(() => document.getElementById('error').textContent = '', 3000);
        }
    </script>
</body>
</html>
